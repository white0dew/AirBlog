---
title: å…¬ä¼—å·å¦‚ä½•å®ç°ç”¨æˆ·æŠ½å¥–åŠŸèƒ½ï¼Ÿ
urlname: girytbel2gdup8q4
date: '2024-06-27 21:23:49'
updated: '2024-06-27 21:24:05'
cover: 'https://cdn.nlark.com/yuque/0/2024/png/22382235/1709885517843-80a6a2ca-81ee-40b7-acab-6a92559b9a79.png'
description: å®ç°èƒŒæ™¯æœ‹å‹æä¸€ä¸ªäº†å…¬ä¼—å·ï¼Œæ‰¾æˆ‘å¸®å¿™å¼€å‘ä¸€ä¸ªåŠŸèƒ½ã€‚ä»–æœ€è¿‘ä¸ºäº†æé«˜å…¬ä¼—å·çš„ç”¨æˆ·ç²˜æ€§ï¼Œéœ€è¦å¢åŠ ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯ç”¨æˆ·å¯ä»¥ç‚¹å‡»å…¬ä¼—ã€æ¯æ—¥ç¤¼åŒ…ã€‘çš„æŒ‰é’®ï¼Œå®ç°æŠ½å¥–ï¼Œè·å¾—å„ç§å¥–åŠ±ç­‰ç­‰ã€‚å®ç°èµ·æ¥å…¶å®æŒºç®€å•çš„ï¼Œæ—¶åºå›¾å¦‚ä¸‹ï¼šå®ç°ç”±äºä¹‹å‰å·²ç»é…ç½®å¥½äº†åå°æœåŠ¡å™¨çš„äº‹ä»¶ç›‘å¬ï¼Œå…¶å®è¿™æ¬¡ä¸»è¦åšçš„å·¥ä½œå°±æ˜¯å®ç°æŠ½å¥–åŠŸèƒ½ã€‚ç®€å•åˆ†...
---
# å®ç°èƒŒæ™¯
æœ‹å‹æä¸€ä¸ªäº†å…¬ä¼—å·ï¼Œæ‰¾æˆ‘å¸®å¿™å¼€å‘ä¸€ä¸ªåŠŸèƒ½ã€‚
ä»–æœ€è¿‘ä¸ºäº†æé«˜å…¬ä¼—å·çš„ç”¨æˆ·ç²˜æ€§ï¼Œéœ€è¦å¢åŠ ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯ç”¨æˆ·å¯ä»¥ç‚¹å‡»å…¬ä¼—ã€æ¯æ—¥ç¤¼åŒ…ã€‘çš„æŒ‰é’®ï¼Œå®ç°æŠ½å¥–ï¼Œè·å¾—å„ç§å¥–åŠ±ç­‰ç­‰ã€‚
å®ç°èµ·æ¥å…¶å®æŒºç®€å•çš„ï¼Œæ—¶åºå›¾å¦‚ä¸‹ï¼š
![image.png](https://oss1.aistar.cool/elog-offer-now/e6039d4b6e10c0aa877232d5666a3c2c.png)
![](https://oss1.aistar.cool/elog-offer-now/e3738c1d697277ae1954b57286a2c835.svg)# å®ç°
ç”±äºä¹‹å‰å·²ç»é…ç½®å¥½äº†åå°æœåŠ¡å™¨çš„äº‹ä»¶ç›‘å¬ï¼Œå…¶å®è¿™æ¬¡ä¸»è¦åšçš„å·¥ä½œå°±æ˜¯å®ç°æŠ½å¥–åŠŸèƒ½ã€‚
ç®€å•åˆ†æä¸€ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªç®€å•çš„æŠ½å¥–ç¨‹åºéœ€è¦è€ƒè™‘å‡ ä¸ªå…³é”®ç‚¹ï¼š**å¥–å“çš„é…ç½®ã€æ¦‚ç‡çš„è®¡ç®—ä»¥åŠæŠ½å¥–ç®—æ³•**ã€‚
ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š
```go
package web_activity

import (
	"fmt"
	"math/rand"
)

type PrizeType int64

const (
	LotteryTypeDay    PrizeType = 1001 // æ—¥å¡
	LotteryTypeWeek   PrizeType = 1002 // å‘¨å¡
	LotteryTypeMonth  PrizeType = 1003 // æœˆå¡
	LotteryTypeSeason PrizeType = 1004 // å­£å¡
	LotteryTypeYear   PrizeType = 1005 // å¹´å¡

	LotteryTypeNum50  PrizeType = 50  // å¢åŠ 50æ¬¡èŠå¤©
	LotteryTypeNum20  PrizeType = 20  // å¢åŠ 20æ¬¡èŠå¤©
	LotteryTypeNum100 PrizeType = 100 // å¢åŠ 100æ¬¡èŠå¤©
	// ...
)

// Prize å®šä¹‰äº†å¥–å“åŠå…¶æ¦‚ç‡
type Prize struct {
	PrizeType   PrizeType // å¥–å“ç±»å‹
	Probability float64   // ä¸­å¥–æ¦‚ç‡
}

// Lottery æŠ½å¥–ç¨‹åº
type Lottery struct {
	Prizes []Prize // å¥–å“åˆ—è¡¨
}

// NewLottery åˆ›å»ºä¸€ä¸ªæ–°çš„Lotteryå®ä¾‹
func NewLottery(prizes []Prize) *Lottery {
	return &Lottery{Prizes: prizes}
}

// Draw æ‰§è¡ŒæŠ½å¥–è¿‡ç¨‹
func (l *Lottery) Draw() *Prize {
	var sum float64
	for _, prize := range l.Prizes {
		sum += prize.Probability
	}

	r := rand.Float64()
	var s float64
	for _, prize := range l.Prizes {
		s += prize.Probability
		if r <= s {
			return &prize
		}
	}

	return nil
}

func main() {
	prizes := []Prize{
		{LotteryTypeNum20, 0.2},
		{LotteryTypeNum50, 0.1},
		{LotteryTypeNum100, 0.05},
		{LotteryTypeDay, 0.05},
		{LotteryTypeWeek, 0.001},
		{LotteryTypeMonth, 0.0005},
		{LotteryTypeSeason, 0.00001},
		{LotteryTypeYear, 0.000001},
	}

	lottery := NewLottery(prizes)

	for i := 0; i < 10; i++ {
		fmt.Println("æŠ½å¥–ç»“æœï¼š", lottery.Draw())
	}
}

```
åœ¨è¿™ä¸ªç¨‹åºä¸­ï¼Œæˆ‘å®šä¹‰äº†`Prize`ç»“æ„ä½“æ¥è¡¨ç¤ºå¥–å“å’Œå®ƒä»¬å¯¹åº”çš„æ¦‚ç‡ã€‚`Lottery`ç»“æ„ä½“åŒ…å«äº†ä¸€ä¸ªå¥–å“åˆ—è¡¨ï¼Œå¹¶æä¾›äº†ä¸€ä¸ª`Draw`æ–¹æ³•æ¥æ‰§è¡ŒæŠ½å¥–è¿‡ç¨‹ã€‚

åœ¨`Draw`æ–¹æ³•ä¸­ç”Ÿæˆä¸€ä¸ª[0,1)èŒƒå›´å†…çš„éšæœºæ•°ï¼Œæ ¹æ®å¥–å“çš„æ¦‚ç‡åŒºé—´æ¥ç¡®å®šä¸­å¥–çš„å¥–å“ã€‚

è¿™æ®µä»£ç å…¶å®å®ç°çš„æ˜¯ä¸€ä¸ªæƒé‡éšæœºé€‰æ‹©å™¨ï¼Œå…¶åŸç†åŸºäºç´¯ç§¯åˆ†å¸ƒå‡½æ•°ï¼ˆCumulative Distribution Function, CDFï¼‰ï¼š

1.  `r := l.random.Float64()`ï¼šç”Ÿæˆäº†ä¸€ä¸ªä»‹äº0åˆ°1ä¹‹é—´çš„éšæœºæµ®ç‚¹æ•°ã€‚è¿™ä¸ªæ•°å¯ä»¥è¢«çœ‹ä½œæ˜¯åœ¨æ¦‚ç‡åˆ†å¸ƒçº¿ä¸Šçš„ä¸€ä¸ªç‚¹ã€‚  
2.  `for _, prize := range l.Prizes`ï¼šè¿™ä¸ªå¾ªç¯éå†æ‰€æœ‰çš„å¥–å“ã€‚ 
3.  `s += prize.Probability`ï¼šåœ¨å¾ªç¯ä¸­ï¼Œæ¯ä¸ªå¥–å“çš„æ¦‚ç‡éƒ½è¢«ç´¯åŠ åˆ°`s`å˜é‡ä¸­ã€‚è¿™ä¸ªç´¯åŠ è¿‡ç¨‹æ„å»ºäº†ä¸€ä¸ªæ¦‚ç‡çš„ç´¯ç§¯åˆ†å¸ƒï¼Œå…¶ä¸­`s`çš„å€¼åœ¨æ¯æ¬¡è¿­ä»£åéƒ½ä¼šå¢åŠ ï¼Œç›´åˆ°æœ€åä¸€ä¸ªå¥–å“çš„æ¦‚ç‡è¢«åŠ ä¸Šã€‚ 
4.  `if r <= s`ï¼šè¿™ä¸ªæ¡ä»¶æ£€æŸ¥éšæœºæ•°`r`æ˜¯å¦å°äºæˆ–ç­‰äºå½“å‰çš„ç´¯ç§¯æ¦‚ç‡`s`ã€‚ç”±äºæ¦‚ç‡æ˜¯ç´¯ç§¯çš„ï¼Œæ¯ä¸ªå¥–å“éƒ½å¯¹åº”äº†æ¦‚ç‡çº¿ä¸Šçš„ä¸€ä¸ªåŒºæ®µã€‚å¦‚æœ`r`è½åœ¨æŸä¸ªå¥–å“å¯¹åº”çš„åŒºæ®µå†…ï¼Œé‚£ä¹ˆè¿™ä¸ªå¥–å“å°±æ˜¯è¢«é€‰ä¸­çš„å¥–å“ã€‚ 

è¿™ä¸ªæ–¹æ³•ç¡®ä¿äº†æ¯ä¸ªå¥–å“è¢«é€‰ä¸­çš„æ¦‚ç‡ä¸å…¶è®¾å®šçš„æ¦‚ç‡ç›¸åŒ¹é…ã€‚ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š

å‡è®¾æœ‰ä¸‰ä¸ªå¥–å“ï¼Œæ¦‚ç‡åˆ†åˆ«ä¸º0.2ã€0.3å’Œ0.5ã€‚æ¦‚ç‡çº¿å¦‚ä¸‹ï¼š
```
|-----0.2-----|-------0.3-------|------------0.5------------|
```

- å¦‚æœ`r`ä»‹äº0åˆ°0.2ä¹‹é—´ï¼Œç¬¬ä¸€ä¸ªå¥–å“è¢«é€‰ä¸­ã€‚
- å¦‚æœ`r`ä»‹äº0.2åˆ°0.5ä¹‹é—´ï¼ˆ0.2 + 0.3ï¼‰ï¼Œç¬¬äºŒä¸ªå¥–å“è¢«é€‰ä¸­ã€‚
- å¦‚æœ`r`ä»‹äº0.5åˆ°1ä¹‹é—´ï¼ˆ0.2 + 0.3 + 0.5ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå¥–å“è¢«é€‰ä¸­ã€‚

è¿™ç§æ–¹æ³•ç®€å•é«˜æ•ˆã€‚
# æ•ˆæœå›¾
å…¬ä¼—å·èœå•ï¼š
![image.png](https://oss1.aistar.cool/elog-offer-now/e5e71995d7391c6795ac73fb59009eb4.png)
æµ‹è¯•æŠ½å¥–100æ¬¡ï¼Œä¸­å¥–æ¬¡æ•°å¤§çº¦å æ®40ï¼Œç»¼åˆä¸­å¥–ç‡è¶³å¤Ÿäº†ï¼Œå†è¯´äº†æ¦‚ç‡è¿™ä¸œè¥¿ï¼Œéšæ—¶éƒ½å¯ä»¥è°ƒæ•´ã€‚
![image.png](https://oss1.aistar.cool/elog-offer-now/1696ccd4726ae01ad13a267eb3bc52cf.png)
ä»¥ä¸Šå°±æ˜¯æ‰€æœ‰çš„è¿‡ç¨‹äº†~å¸Œæœ›å„ä½çœ‹å®˜èµè„¸ç‚¹ä¸ªèµå“ˆğŸ˜†
